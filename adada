-- Stub out JIT/virtualization markers if this script isn't obfuscated
if not LPH_OBFUSCATED then
    LPH_JIT_MAX = function(...)
        return (...)
    end
    LPH_NO_VIRTUALIZE = function(...)
        return (...)
    end
end

-- Only allow this script to run in specified places
local allowedPlaceIds = {
    [2788229376] = true,
}

repeat task.wait() until game:IsLoaded()

if not allowedPlaceIds[game.PlaceId] then
    return
end

-- Grab services and player
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Hook namecall to block kicks
local mt = getrawmetatable(game)
setreadonly(mt, false)
local oldNamecall = mt.__namecall
mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    if not checkcaller() and method == "Kick" and self == LocalPlayer then
        warn("[Bypass] Kick attempt blocked.")
        return
    end
    return oldNamecall(self, ...)
end)
setreadonly(mt, true)

-- Hook getfenv to hide environments from non-callers
local originalGetFenv = getrenv().getfenv
if typeof(originalGetFenv) == "function" then
    hookfunction(originalGetFenv, newcclosure(function(level)
        if not checkcaller() then
            return {}
        end
        return originalGetFenv(level)
    end))
end
